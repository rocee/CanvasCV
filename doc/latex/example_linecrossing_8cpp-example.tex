\hypertarget{example_linecrossing_8cpp-example}{}\section{example\+\_\+linecrossing.\+cpp}
This is an example of how to use the Line\+Crossing shape.


\begin{DoxyCodeInclude}
\textcolor{comment}{// Mandator include file}
\textcolor{preprocessor}{#include "canvascv/canvas.h"}

\textcolor{comment}{// We need specific linecrossing and arrow features here}
\textcolor{preprocessor}{#include "canvascv/shapes/linecrossing.h"}
\textcolor{preprocessor}{#include "canvascv/shapes/arrow.h"}

\textcolor{preprocessor}{#include <iostream>}
\textcolor{preprocessor}{#include <iterator>}

\textcolor{preprocessor}{#include <opencv2/highgui.hpp>}

\textcolor{keyword}{using namespace }\hyperlink{namespacestd}{std};
\textcolor{keyword}{using namespace }\hyperlink{namespacecv}{cv};
\textcolor{keyword}{using namespace }\hyperlink{namespacecanvascv}{canvascv};

\textcolor{keyword}{static} \textcolor{keywordtype}{string} gHelpMsg =
\textcolor{stringliteral}{"Usage:\(\backslash\)n"}
\textcolor{stringliteral}{"=====\(\backslash\)n"}
\textcolor{stringliteral}{"Use the mouse and keyboard.\(\backslash\)n"}
\textcolor{stringliteral}{"Click and drag to create and drag arrows\(\backslash\)n"}
\textcolor{stringliteral}{"acrooss the LineCrossing.\(\backslash\)n"}
\textcolor{stringliteral}{"Change the LineCrossing direction and\(\backslash\)n"}
\textcolor{stringliteral}{"create/drag the arrows again.\(\backslash\)n"}
\textcolor{stringliteral}{"Use these keys:\(\backslash\)n"}
\textcolor{stringliteral}{"h: toggle usage message\(\backslash\)n"}
\textcolor{stringliteral}{"DEL: delete active shape (deleting the\(\backslash\)n"}
\textcolor{stringliteral}{"LineCrossing will exit)\(\backslash\)n"}
\textcolor{stringliteral}{"q: exit"};

\textcolor{keywordtype}{void} help(\hyperlink{classcanvascv_1_1Canvas}{Canvas} &c)
\{
    \textcolor{keyword}{static} \textcolor{keywordtype}{bool} showHelp = \textcolor{keyword}{true};
    \textcolor{keywordflow}{if} (showHelp)
    \{
        cout << gHelpMsg << endl;
        c.\hyperlink{classcanvascv_1_1Canvas_aaedea276b82a8a4cfc0895ae81113cfd}{setScreenText}(gHelpMsg);
    \}
    \textcolor{keywordflow}{else}
    \{
        c.\hyperlink{classcanvascv_1_1Canvas_aaedea276b82a8a4cfc0895ae81113cfd}{setScreenText}(\textcolor{stringliteral}{""});
    \}
    showHelp = ! showHelp;
\}

\textcolor{keywordtype}{void} setArrowColors(\hyperlink{classcanvascv_1_1LineCrossing}{LineCrossing} &lc, \hyperlink{classcanvascv_1_1Arrow}{Arrow} &arrow, Scalar defaultColor)
\{
    \hyperlink{classcanvascv_1_1Handle}{Handle} &tail = arrow.\hyperlink{classcanvascv_1_1Line_a685abcca89d05c63186ef71c0ef8b0a2}{getPT1}();
    \hyperlink{classcanvascv_1_1Handle}{Handle} &head = arrow.\hyperlink{classcanvascv_1_1Line_a7a0fc9d06ab0fc575b1596068dff0484}{getPT2}();
    \textcolor{keywordtype}{int} crossing = lc.\hyperlink{classcanvascv_1_1LineCrossing_a940cbb0be9bea9acbd82493916b1b3d6}{isCrossedBySegment}(tail(), head());
    \textcolor{keywordflow}{switch} (crossing)
    \{
    \textcolor{keywordflow}{case} 1:
        arrow.\hyperlink{classcanvascv_1_1CompoundShape_a5b01540c58f0bb5d5a7feccfa38568f9}{setOutlineColor}(\hyperlink{classcanvascv_1_1Colors_a93c492d5ea68350ee63d5b91315b5ea7}{Colors::Green});
        \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{case} -1:
        arrow.\hyperlink{classcanvascv_1_1CompoundShape_a5b01540c58f0bb5d5a7feccfa38568f9}{setOutlineColor}(\hyperlink{classcanvascv_1_1Colors_a10aff24c53edf45b038d0636b061f9c2}{Colors::Red});
        \textcolor{keywordflow}{break};
    \textcolor{keywordflow}{default}:
        arrow.\hyperlink{classcanvascv_1_1CompoundShape_a5b01540c58f0bb5d5a7feccfa38568f9}{setOutlineColor}(defaultColor);
        \textcolor{keywordflow}{break};
    \}
\}

\textcolor{keywordtype}{int} main(\textcolor{keywordtype}{int} argc, \textcolor{keywordtype}{char} **argv)
\{
    --argc;
    ++argv;
    Mat image;
    \textcolor{keywordflow}{if} (argc)
    \{
        Mat orig = imread(argv[0], IMREAD\_UNCHANGED);
        \textcolor{keywordflow}{if} (orig.empty())
        \{
            \hyperlink{classcanvascv_1_1Canvas_add93c0d5cc1e9b49f97510952a8a1961}{Canvas::fatal}(\textcolor{keywordtype}{string}(\textcolor{stringliteral}{"Cannot load image "}) + argv[0], -1);
        \}
        \textcolor{keywordflow}{if} (orig.cols > 1024)
        \{
            \textcolor{keywordtype}{double} ratio = 1024. / orig.cols;
            cv::resize(orig, image, Size(), ratio, ratio);
        \}
        \textcolor{keywordflow}{else}
        \{
            image = orig;
        \}
    \}
    \textcolor{keywordflow}{else}
    \{
        image.create(600, 800, CV\_8UC3);
        image = \hyperlink{classcanvascv_1_1Colors_a79938bbb8f85fc8c8aa34a7934890c08}{Colors::White};
    \}

    \hyperlink{classcanvascv_1_1Canvas}{Canvas} c(\textcolor{stringliteral}{"Canvas"}, image.size());
    c.\hyperlink{classcanvascv_1_1Canvas_ac61735c6f4cb6a88d84331540ab25d39}{setShapeType}(\textcolor{stringliteral}{"Arrow"}); \textcolor{comment}{// default shape type for direct GUI creation}
    c.enableScreenText();
    c.enableStatusMsg();
    help(c);

    \textcolor{comment}{// create the line-crossing}
    shared\_ptr<LineCrossing> lc = c.createShape<\hyperlink{classcanvascv_1_1LineCrossing}{LineCrossing}>();
    lc->\hyperlink{classcanvascv_1_1LineCrossing_a9ee35848f19c6841cc59a373726ba8dc}{getLine}()->\hyperlink{classcanvascv_1_1Line_a51eccef05df0ea69f99ee9eca3f3b12c}{setTailPos}(Point(image.cols / 2, image.rows * 0.75));
    lc->getLine()->setHeadPos(Point(image.cols / 2, image.cols * 0.25));

    \textcolor{comment}{// notifyOnCreate callbacks can be used for many things.}
    \textcolor{comment}{// Here we bind Arrow modificatons and LineCrossing modifications}
    \textcolor{comment}{// to call setArrowColors()}
    c.notifyOnShapeCreate([lc, &c](\hyperlink{classcanvascv_1_1Shape}{Shape} *arrowShape)
    \{
        \textcolor{keywordflow}{if} (arrowShape->\hyperlink{classcanvascv_1_1Shape_adee3cc696c7e82b0d2946e7e667ddd46}{getType}() == Arrow::type)
        \{
            \hyperlink{classcanvascv_1_1Arrow}{Arrow} *arrow = (\hyperlink{classcanvascv_1_1Arrow}{Arrow}*) arrowShape;
            Scalar defaultColor = arrowShape->\hyperlink{classcanvascv_1_1Shape_a67d3bdec3be2a29c3612c87208589838}{getOutlineColor}();
            setArrowColors(*lc, *arrow, defaultColor);
            Handle::PosChangedCB cb = [arrow, defaultColor, lc](\textcolor{keyword}{const} Point&)
            \{
                setArrowColors(*lc, *arrow, defaultColor);
            \};
            arrow->\hyperlink{classcanvascv_1_1Line_a685abcca89d05c63186ef71c0ef8b0a2}{getPT1}().\hyperlink{classcanvascv_1_1Handle_adf028dcb7c12a711351d9a5794b1df69}{addPosChangedCB}(cb);
            arrow->\hyperlink{classcanvascv_1_1Line_a7a0fc9d06ab0fc575b1596068dff0484}{getPT2}().\hyperlink{classcanvascv_1_1Handle_adf028dcb7c12a711351d9a5794b1df69}{addPosChangedCB}(cb);

             \textcolor{comment}{// register for LineCrossing's directional arrow changes}
            \textcolor{keyword}{auto} cbId = lc->getArrow()->getPT1().addPosChangedCB(cb);

            \textcolor{comment}{// If an arrow is deleted, don't let the LineCrossing's directional}
            \textcolor{comment}{//  arrow notify it about changes}
            \textcolor{keywordtype}{int} shapeId = lc->getArrow()->getPT1().getId();
            c.notifyOnShapeDelete([&c, arrow, shapeId, cbId](\hyperlink{classcanvascv_1_1Shape}{Shape} *deleted)
            \{
                \textcolor{keywordflow}{if} (arrow == deleted)
                \{
                    \textcolor{keyword}{auto} shapePtr = c.getShape(shapeId);
                    \textcolor{keywordflow}{if} (shapePtr)
                    \{
                        ((\hyperlink{classcanvascv_1_1Handle}{Handle}*)shapePtr.get())->delPosChangedCB(cbId);
                    \}
                \}
            \});
        \}
    \});

    \textcolor{comment}{// when the LiceCrossing is reset the while loop will exit}
    c.notifyOnShapeDelete([&lc](\hyperlink{classcanvascv_1_1Shape}{Shape} *shape) \{ \textcolor{keywordflow}{if} (shape->\hyperlink{classcanvascv_1_1Shape_adee3cc696c7e82b0d2946e7e667ddd46}{getType}() == LineCrossing::type) lc.
      reset(); \});

    namedWindow(\textcolor{stringliteral}{"Canvas"}, WINDOW\_AUTOSIZE);
    c.setMouseCallback(); \textcolor{comment}{// optional for mouse usage see also (example\_selectbox.cpp)}

    \textcolor{keywordtype}{int} key = 0;
    Mat out; \textcolor{comment}{// keeping it out of the loop is a little more efficient}
    \textcolor{keywordflow}{while} (lc && key != \textcolor{charliteral}{'q'})
    \{
        \textcolor{keywordflow}{switch} (key)
        \{
        \textcolor{keywordflow}{case} \textcolor{charliteral}{'h'}:
            help(c);
            \textcolor{keywordflow}{break};
        \textcolor{keywordflow}{case} 65535:
            c.deleteActive();
            \textcolor{keywordflow}{break};
        \}

        c.redrawOn(image, out);
        imshow(\textcolor{stringliteral}{"Canvas"}, out);
        key = c.waitKeyEx(); \textcolor{comment}{// GUI and callbacks happen here}
    \}

    destroyAllWindows();
    \textcolor{keywordflow}{return} 0;
\}
\end{DoxyCodeInclude}
 