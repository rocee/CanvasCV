---
layout: reference
sitemap: false
---
<!-- HTML header for doxygen 1.8.11-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtmlcharset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>CanvasCV: Creating shapes</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen_style.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px">
  <td id="projectalign" style="padding-left: 0.5em">
   <div id="projectname">CanvasCV
   &#160<span id="projectnumber">1.0.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",true,'Search');
</script>
  <div class="doxygen-search-container">
        <div id="MSearchBox" class="MSearchBoxInactive" style="z-index:auto; right:auto; left:0">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
  </div>

        <!-- window showing the filter options -->
        <div id="MSearchSelectWindow"
             onmouseover="return searchBox.OnSearchSelectShow()"
             onmouseout="return searchBox.OnSearchSelectHide()"
             onkeydown="return searchBox.OnSearchSelectKey(event)">
        </div>

        <!-- iframe showing the search results (closed by default) -->
  <div class="doxygen-search-results-container">
        <div id="MSearchResultsWindow">
        <iframe src="javascript:void(0)" frameborder="0" 
                name="MSearchResults" id="MSearchResults">
        </iframe>
        </div>
  </div>

  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->

<!-- iframe showing the search results (closed by default) -->

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="tutorials.html">Tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Creating shapes </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#shapes_s1">Creating a polygon from the GUI</a></li>
<li class="level1"><a href="#shapes_s2">Creating a clickable rectangle from code</a></li>
</ul>
</div>
<div class="textblock"><p>CanvasCV's support of shapes is one of it's strongest points.</p>
<p>You have 2 ways of creating shapes:</p><ul>
<li><b>From the GUI</b> (with the mouse and keyboard) - for example to let the user select a polygon mask as an area of intereset for the CV.</li>
<li><b>From the code</b> - for example creating a clickable rectangle on screen to which a <em>SelectionBox</em> widget can be applied.</li>
</ul>
<h1><a class="anchor" id="shapes_s1"></a>
Creating a polygon from the GUI</h1>
<p>In this example we want to user to mark a polygon area on the image or frame.</p>
<p>There could be various reasons for that:</p><ul>
<li>Maybe the camera is capturing a large area and we want to operate our algorithm on a relevant dynamic subset of it.</li>
<li>The user selects a polygon area that triggers an alert when tracked objects are inside it.</li>
<li>etc.</li>
</ul>
<p>When the user creates/modifies/deletes the polygon we'll just print the vertices to the screen.</p>
<p>Here is the code: </p><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;canvascv/canvas.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;canvascv/shapes/polygon.h&gt;</span></div><div class="line"></div><div class="line"><span class="preprocessor">#include &lt;opencv2/highgui.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacecv.html">cv</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacecanvascv.html">canvascv</a>;</div><div class="line"></div><div class="line"><span class="keywordtype">void</span> handlePolyPoints(<a class="code" href="classcanvascv_1_1Canvas.html">Canvas</a> &amp;c, <a class="code" href="classcanvascv_1_1Polygon.html">Polygon</a> &amp;poly)</div><div class="line">{</div><div class="line">    vector&lt;Point&gt; polyPoints;</div><div class="line">    poly.<a class="code" href="classcanvascv_1_1Polygon.html#ada0df457225c06769d7a90d71f58ed7f">getPoints</a>(polyPoints);</div><div class="line">    stringstream s;</div><div class="line">    s &lt;&lt;  <span class="stringliteral">&quot;polygon points are at :\n[&quot;</span>;</div><div class="line">    <span class="keywordflow">for</span> (<span class="keyword">auto</span> &amp;v : polyPoints)</div><div class="line">    {</div><div class="line">        s &lt;&lt; <span class="stringliteral">&quot; &quot;</span> &lt;&lt; v &lt;&lt; <span class="stringliteral">&quot; &quot;</span>;</div><div class="line">    }</div><div class="line">    s &lt;&lt;  <span class="stringliteral">&quot;]\n\n&quot;</span>;</div><div class="line">    s &lt;&lt;  <span class="stringliteral">&quot;Use q to exit.&quot;</span>;</div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#aaedea276b82a8a4cfc0895ae81113cfd">setScreenText</a>(s.str());</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div><div class="line">{</div><div class="line">    --argc;</div><div class="line">    ++argv;</div><div class="line">    <span class="keywordflow">if</span> (! argc)</div><div class="line">    {</div><div class="line">        Canvas::fatal(<span class="stringliteral">&quot;Must get a path to an image as a parameter&quot;</span> , -1);</div><div class="line">    }</div><div class="line"></div><div class="line">    Mat image = imread(argv[0]);</div><div class="line">    <span class="keywordflow">if</span> (image.empty())</div><div class="line">    {</div><div class="line">        Canvas::fatal(<span class="keywordtype">string</span>(<span class="stringliteral">&quot;Cannot load image &quot;</span>) + argv[0], -2);</div><div class="line">    }</div><div class="line"></div><div class="line">    <a class="code" href="classcanvascv_1_1Canvas.html">Canvas</a> c(<span class="stringliteral">&quot;Shapes&quot;</span>, image.size());</div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#ae68d3277e738d349232400b38f0e5f9e">enableScreenText</a>();</div><div class="line"></div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#a402c43a42c0089c48a96e5303c1c1fe8">enableStatusMsg</a>();</div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#a14828809edd29d789170284a86f16f23">setDefaultStatusMsg</a>(<span class="stringliteral">&quot;Click-Release-Drag to create a single polygon.\n&quot;</span></div><div class="line">                          <span class="stringliteral">&quot;Select/Unselect with the mouse.\n&quot;</span></div><div class="line">                          <span class="stringliteral">&quot;Drag selected polygon with the mouse.\n&quot;</span></div><div class="line">                          <span class="stringliteral">&quot;DEL deleted the selected shape.&quot;</span>);</div><div class="line"></div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#ac61735c6f4cb6a88d84331540ab25d39">setShapeType</a>(Polygon::type); <span class="comment">// default shape type for direct GUI creation</span></div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#a64a459b16965e23de992cd2a301c68f4">notifyOnShapeCreate</a>([&amp;c](<a class="code" href="classcanvascv_1_1Shape.html">Shape</a>* shape)</div><div class="line">    {</div><div class="line">        handlePolyPoints(c, *(<a class="code" href="classcanvascv_1_1Polygon.html">Polygon</a>*) shape); <span class="comment">// it can only be a Polygon</span></div><div class="line">        c.<a class="code" href="classcanvascv_1_1Canvas.html#ac61735c6f4cb6a88d84331540ab25d39">setShapeType</a>(<span class="stringliteral">&quot;&quot;</span>); <span class="comment">// default shape type for direct GUI creation</span></div><div class="line">    });</div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#a5a6da8ae08b08a20d7fe15564bda5515">notifyOnShapeModify</a>([&amp;c](<a class="code" href="classcanvascv_1_1Shape.html">Shape</a>* shape)</div><div class="line">    {</div><div class="line">        handlePolyPoints(c, *(<a class="code" href="classcanvascv_1_1Polygon.html">Polygon</a>*) shape);</div><div class="line">    });</div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#a1e7c26b39fd247e85941a6542f1b94c3">notifyOnShapeDelete</a>([&amp;c](<a class="code" href="classcanvascv_1_1Shape.html">Shape</a>*)</div><div class="line">    {</div><div class="line">        c.<a class="code" href="classcanvascv_1_1Canvas.html#ac61735c6f4cb6a88d84331540ab25d39">setShapeType</a>(Polygon::type); <span class="comment">// default shape type for direct GUI creation</span></div><div class="line">    });</div><div class="line"></div><div class="line">    namedWindow(<span class="stringliteral">&quot;Shapes&quot;</span>, WINDOW_AUTOSIZE);</div><div class="line">    c.<a class="code" href="classcanvascv_1_1Canvas.html#acf6e5d4b40aec610b0dc8c4f6bf93ac1">setMouseCallback</a>(); <span class="comment">// optional for mouse usage see also (example_selectbox.cpp)</span></div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> key = 0;</div><div class="line">    Mat out; <span class="comment">// keeping it out of the loop is a little more efficient</span></div><div class="line">    <span class="keywordflow">do</span></div><div class="line">    {</div><div class="line">        <span class="keywordflow">switch</span> (key)</div><div class="line">        {</div><div class="line">        <span class="keywordflow">case</span> 65535:</div><div class="line">            c.<a class="code" href="classcanvascv_1_1Canvas.html#a2fb88addb88a21757d4272e64acd30ae">deleteActive</a>();</div><div class="line">            c.<a class="code" href="classcanvascv_1_1Canvas.html#aaedea276b82a8a4cfc0895ae81113cfd">setScreenText</a>(<span class="stringliteral">&quot;&quot;</span>);</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line"></div><div class="line">        c.<a class="code" href="classcanvascv_1_1Canvas.html#a018c66e277de7904b8146ea3f3feebdd">redrawOn</a>(image, out);</div><div class="line">        c.<a class="code" href="classcanvascv_1_1Canvas.html#acaf9494a5668046dd0a8908aa97a7a43">imshow</a>(out);</div><div class="line">        key = c.<a class="code" href="classcanvascv_1_1Canvas.html#a59397db05f5d9e45264f626f6a2ae528">waitKeyEx</a>(); <span class="comment">// GUI and callbacks happen here</span></div><div class="line">    } <span class="keywordflow">while</span> (key != <span class="charliteral">&#39;q&#39;</span>);</div><div class="line"></div><div class="line">    destroyAllWindows();</div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p> Notes:</p><ul>
<li><a class="el" href="classcanvascv_1_1Canvas.html#a402c43a42c0089c48a96e5303c1c1fe8" title="enableStatusMsg enables the bottom left text area for auto status messages ">canvascv::Canvas::enableStatusMsg()</a> is optional, but recommended when using shapes and widgets. It takes a small portion of the screen area, but gives helpful information to the user.</li>
<li><a class="el" href="classcanvascv_1_1Canvas.html#a14828809edd29d789170284a86f16f23" title="set the default status message (active widget and shapes will override it) ">canvascv::Canvas::setDefaultStatusMsg()</a> is optional. There are built in status messages that are displayed during shape creation and editing. When nothing is selected, then your default status message will be displayed.</li>
<li>The Canvas needs to know what shape to create when the user left clicks with the mouse. This is done with <a class="el" href="classcanvascv_1_1Canvas.html#ac61735c6f4cb6a88d84331540ab25d39" title="set default shape type to draw (could be &quot;&quot;) ">canvascv::Canvas::setShapeType()</a>.</li>
<li>You can register for Canvas create/modify/delete notification on the Shapes that it creates/modify/deletes. This is the place to react to the user's GUI actions.</li>
<li>When executed with a path to an image, this gives you (depends on your image): <div class="image">
<img src="tut_shapes_gui.jpg" alt="tut_shapes_gui.jpg"/>
</div>
 <br />
</li>
</ul>
<h1><a class="anchor" id="shapes_s2"></a>
Creating a clickable rectangle from code</h1>
<p>As you know, in CV tracking is split into 2 phases - detection and tracking.</p>
<p>Let's assume we have a people detection code, and we're detecting people in a croud.</p>
<p>We want to enable the user to choose a specific detection to start tracking. In the most simple form - we want the rectangles we draw to do something when they are clicked.</p>
<p>In this tutorial we won't track anything, but just output the chosen rectangle coordinates to the screen.</p>
<p>The base code we'll be using is from <em>OpenCV-3.2.0/samples/cpp/peopledetect.cpp</em>.</p>
<p>The modified code can be optimized for performance, but here we just want to show the <em>CanvasCV</em> way of doing it.</p>
<p>You are encouraged to diff the tutorial version and the OpenCV version with your favorite diff tool, but the most important difference is this:</p>
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;&lt;         rectangle(img, r.tl(), r.br(), cv::Scalar(0,255,0), 3);</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;---</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;&gt;         shared_ptr&lt;Rectangle&gt; shapeRect = canvas.createShape&lt;Rectangle&gt;();</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;&gt;         shapeRect-&gt;setRect(cv::RotatedRect(Point(r.x + r.width / 2., r.y + r.height / 2.), r.size(), 0));</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;&gt;         shapeRect-&gt;setOutlineColor(Colors::Green);</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;&gt;         shapeRect-&gt;setThickness(3);</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;&gt;         shapeRect-&gt;setLocked(true); // cannot be dragged</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;&gt;         shapeRect-&gt;notifyOnEvent([&amp;canvas](Shape *shape, Shape::Event evt)</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;&gt;         {</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;&gt;             if (evt == Shape::SELECT)</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;&gt;             {</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;&gt;                 canvas.setScreenText(CCV_STR(&quot;User clicked in rect &quot; &lt;&lt; ((Rectangle*)shape)-&gt;getRect().boundingRect()));</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;&gt;             }</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;&gt;         });</div></div><!-- fragment --><p>In the code above, instead of drawing a rectangle, we create a <a class="el" href="classcanvascv_1_1Rectangle.html" title="The Rectangle class. ">canvascv::Rectangle</a> object on the <em>Canvas</em> and attach a callback to that specific instance.</p>
<p>The <a class="el" href="classcanvascv_1_1Shape.html#a3fa381d7be3c6bb3cd736e237a444d5c" title="The Event enum will let you know what just happended to the shape. ">canvascv::Shape::Event</a> we want is <em>SELECT</em>, which is when a shape is selected with the mouse (Clicked).</p>
<p>The full code is a little long because the original code is long:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;stdexcept&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;opencv2/objdetect.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;opencv2/highgui.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;opencv2/imgproc.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;opencv2/imgcodecs.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;opencv2/video.hpp&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;opencv2/videoio.hpp&gt;</span></div><div class="line"></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacecv.html">cv</a>;</div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacestd.html">std</a>;</div><div class="line"></div><div class="line"><span class="comment">// CanvasCV change#1 - include and namespace</span></div><div class="line"><span class="preprocessor">#include &lt;canvascv/canvas.h&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;canvascv/shapes/rectangle.h&gt;</span></div><div class="line"><span class="keyword">using namespace </span><a class="code" href="namespacecanvascv.html">canvascv</a>;</div><div class="line"></div><div class="line"></div><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* keys =</div><div class="line">{</div><div class="line">    <span class="stringliteral">&quot;{ help h      |                     | print help message }&quot;</span></div><div class="line">    <span class="stringliteral">&quot;{ image i     |                     | specify input image}&quot;</span></div><div class="line">    <span class="stringliteral">&quot;{ camera c    |                     | enable camera capturing }&quot;</span></div><div class="line">    <span class="stringliteral">&quot;{ video v     | ../data/vtest.avi   | use video as input }&quot;</span></div><div class="line">    <span class="stringliteral">&quot;{ directory d |                     | images directory}&quot;</span></div><div class="line">};</div><div class="line"></div><div class="line"><span class="comment">// CanvasCV change#8 - we draw on the canvas instead of the real img</span></div><div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> detectAndDraw(<span class="keyword">const</span> HOGDescriptor &amp;hog, Mat &amp;img, <a class="code" href="classcanvascv_1_1Canvas.html">Canvas</a> &amp;canvas)</div><div class="line">{</div><div class="line">    vector&lt;Rect&gt; found, found_filtered;</div><div class="line">    <span class="keywordtype">double</span> t = (double) getTickCount();</div><div class="line">    <span class="comment">// Run the detector with default parameters. to get a higher hit-rate</span></div><div class="line">    <span class="comment">// (and more false alarms, respectively), decrease the hitThreshold and</span></div><div class="line">    <span class="comment">// groupThreshold (set groupThreshold to 0 to turn off the grouping completely).</span></div><div class="line">    hog.detectMultiScale(img, found, 0, Size(8,8), Size(32,32), 1.05, 2);</div><div class="line">    t = (double) getTickCount() - t;</div><div class="line">    cout &lt;&lt; <span class="stringliteral">&quot;detection time = &quot;</span> &lt;&lt; (t*1000./cv::getTickFrequency()) &lt;&lt; <span class="stringliteral">&quot; ms&quot;</span> &lt;&lt; endl;</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">size_t</span> i = 0; i &lt; found.size(); i++ )</div><div class="line">    {</div><div class="line">        Rect r = found[i];</div><div class="line"></div><div class="line">        <span class="keywordtype">size_t</span> j;</div><div class="line">        <span class="comment">// Do not add small detections inside a bigger detection.</span></div><div class="line">        <span class="keywordflow">for</span> ( j = 0; j &lt; found.size(); j++ )</div><div class="line">            <span class="keywordflow">if</span> ( j != i &amp;&amp; (r &amp; found[j]) == r )</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> ( j == found.size() )</div><div class="line">            found_filtered.push_back(r);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">for</span> (<span class="keywordtype">size_t</span> i = 0; i &lt; found_filtered.size(); i++)</div><div class="line">    {</div><div class="line">        Rect r = found_filtered[i];</div><div class="line"></div><div class="line">        <span class="comment">// The HOG detector returns slightly larger rectangles than the real objects,</span></div><div class="line">        <span class="comment">// so we slightly shrink the rectangles to get a nicer output.</span></div><div class="line">        r.x += cvRound(r.width*0.1);</div><div class="line">        r.width = cvRound(r.width*0.8);</div><div class="line">        r.y += cvRound(r.height*0.07);</div><div class="line">        r.height = cvRound(r.height*0.8);</div><div class="line">        shared_ptr&lt;Rectangle&gt; shapeRect = canvas.<a class="code" href="classcanvascv_1_1Canvas.html#a630ac92458f1718d0c597e96dd5a4aef">createShape</a>&lt;<a class="code" href="classcanvascv_1_1Rectangle.html">Rectangle</a>&gt;();</div><div class="line">        shapeRect-&gt;<a class="code" href="classcanvascv_1_1Rectangle.html#a5149d50c87c3388619ace3badd868f50">setRect</a>(cv::RotatedRect(Point(r.x + r.width / 2., r.y + r.height / 2.), r.size(), 0));</div><div class="line">        shapeRect-&gt;setOutlineColor(Colors::Green);</div><div class="line">        shapeRect-&gt;setThickness(3);</div><div class="line">        shapeRect-&gt;setLocked(<span class="keyword">true</span>); <span class="comment">// cannot be dragged</span></div><div class="line">        shapeRect-&gt;notifyOnEvent([&amp;canvas](<a class="code" href="classcanvascv_1_1Shape.html">Shape</a> *shape, <a class="code" href="classcanvascv_1_1Shape.html#a3fa381d7be3c6bb3cd736e237a444d5c">Shape::Event</a> evt)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (evt == Shape::SELECT)</div><div class="line">            {</div><div class="line">                canvas.<a class="code" href="classcanvascv_1_1Canvas.html#aaedea276b82a8a4cfc0895ae81113cfd">setScreenText</a>(CCV_STR(<span class="stringliteral">&quot;User clicked in rect &quot;</span> &lt;&lt; ((<a class="code" href="classcanvascv_1_1Rectangle.html">Rectangle</a>*)shape)-&gt;getRect().boundingRect()));</div><div class="line">            }</div><div class="line">        });</div><div class="line">    }</div><div class="line">}</div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div><div class="line">{</div><div class="line">    CommandLineParser parser(argc, argv, keys);</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;help&quot;</span>))</div><div class="line">    {</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;\nThis program demonstrates the use of the HoG descriptor using\n&quot;</span></div><div class="line">            <span class="stringliteral">&quot; HOGDescriptor::hog.setSVMDetector(HOGDescriptor::getDefaultPeopleDetector());\n&quot;</span>;</div><div class="line">        parser.printMessage();</div><div class="line">        cout &lt;&lt; <span class="stringliteral">&quot;During execution:\n\tHit q or ESC key to quit.\n&quot;</span></div><div class="line">            <span class="stringliteral">&quot;\tUsing OpenCV version &quot;</span> &lt;&lt; CV_VERSION &lt;&lt; <span class="stringliteral">&quot;\n&quot;</span></div><div class="line">            <span class="stringliteral">&quot;Note: camera device number must be different from -1.\n&quot;</span> &lt;&lt; endl;</div><div class="line">        <span class="keywordflow">return</span> 0;</div><div class="line">    }</div><div class="line"></div><div class="line">    HOGDescriptor hog;</div><div class="line">    hog.setSVMDetector(HOGDescriptor::getDefaultPeopleDetector());</div><div class="line">    namedWindow(<span class="stringliteral">&quot;people detector&quot;</span>, 1);</div><div class="line"></div><div class="line">    <span class="comment">// CanvasCV change#2 - attach a canvas to a window with mouse callbacks</span></div><div class="line">    <a class="code" href="classcanvascv_1_1Canvas.html">Canvas</a> canvas(<span class="stringliteral">&quot;people detector&quot;</span>);</div><div class="line">    canvas.<a class="code" href="classcanvascv_1_1Canvas.html#ae68d3277e738d349232400b38f0e5f9e">enableScreenText</a>();</div><div class="line">    canvas.<a class="code" href="classcanvascv_1_1Canvas.html#acf6e5d4b40aec610b0dc8c4f6bf93ac1">setMouseCallback</a>();</div><div class="line"></div><div class="line">    <span class="keywordtype">string</span> pattern_glob = <span class="stringliteral">&quot;&quot;</span>;</div><div class="line">    <span class="keywordtype">string</span> video_filename = <span class="stringliteral">&quot;../data/vtest.avi&quot;</span>;</div><div class="line">    <span class="keywordtype">int</span> camera_id = -1;</div><div class="line">    <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;directory&quot;</span>))</div><div class="line">    {</div><div class="line">        pattern_glob = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;directory&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;image&quot;</span>))</div><div class="line">    {</div><div class="line">        pattern_glob = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;image&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;camera&quot;</span>))</div><div class="line">    {</div><div class="line">        camera_id = parser.get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;camera&quot;</span>);</div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (parser.has(<span class="stringliteral">&quot;video&quot;</span>))</div><div class="line">    {</div><div class="line">        video_filename = parser.get&lt;<span class="keywordtype">string</span>&gt;(<span class="stringliteral">&quot;video&quot;</span>);</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">if</span> (!pattern_glob.empty() || camera_id != -1 || !video_filename.empty())</div><div class="line">    {</div><div class="line">        <span class="comment">//Read from input image files</span></div><div class="line">        vector&lt;String&gt; filenames;</div><div class="line">        <span class="comment">//Read from video file</span></div><div class="line">        VideoCapture vc;</div><div class="line">        Mat frame;</div><div class="line"></div><div class="line">        <span class="keywordflow">if</span> (!pattern_glob.empty())</div><div class="line">        {</div><div class="line">            String folder(pattern_glob);</div><div class="line">            glob(folder, filenames);</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> <span class="keywordflow">if</span> (camera_id != -1)</div><div class="line">        {</div><div class="line">            vc.open(camera_id);</div><div class="line">            <span class="keywordflow">if</span> (!vc.isOpened())</div><div class="line">            {</div><div class="line">                <span class="comment">// CanvasCV change#3 - using fatal</span></div><div class="line">                Canvas::fatal(CCV_STR(<span class="stringliteral">&quot;can&#39;t open camera: &quot;</span> &lt;&lt; camera_id), -1);</div><div class="line">            }</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span></div><div class="line">        {</div><div class="line">            vc.open(video_filename.c_str());</div><div class="line">            <span class="comment">// CanvasCV change#4 - using fatal</span></div><div class="line">            <span class="keywordflow">if</span> (!vc.isOpened())</div><div class="line">                Canvas::fatal(CCV_STR(<span class="stringliteral">&quot;can&#39;t open video file: &quot;</span> &lt;&lt; video_filename), -1);</div><div class="line">        }</div><div class="line"></div><div class="line">        vector&lt;String&gt;::const_iterator it_image = filenames.begin();</div><div class="line"></div><div class="line">        Mat out;</div><div class="line">        <span class="keywordflow">for</span> (;;)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (!pattern_glob.empty())</div><div class="line">            {</div><div class="line">                <span class="keywordtype">bool</span> read_image_ok = <span class="keyword">false</span>;</div><div class="line">                <span class="keywordflow">for</span> (; it_image != filenames.end(); ++it_image)</div><div class="line">                {</div><div class="line">                    cout &lt;&lt; <span class="stringliteral">&quot;\nRead: &quot;</span> &lt;&lt; *it_image &lt;&lt; endl;</div><div class="line">                    <span class="comment">// Read current image</span></div><div class="line">                    frame = imread(*it_image);</div><div class="line"></div><div class="line">                    <span class="keywordflow">if</span> (!frame.empty())</div><div class="line">                    {</div><div class="line">                        ++it_image;</div><div class="line">                        read_image_ok = <span class="keyword">true</span>;</div><div class="line">                        <span class="keywordflow">break</span>;</div><div class="line">                    }</div><div class="line">                }</div><div class="line"></div><div class="line">                <span class="comment">//No more valid images</span></div><div class="line">                <span class="keywordflow">if</span> (!read_image_ok)</div><div class="line">                {</div><div class="line">                    <span class="comment">//Release the image in order to exit the while loop</span></div><div class="line">                    frame.release();</div><div class="line">                }</div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                vc &gt;&gt; frame;</div><div class="line">            }</div><div class="line"></div><div class="line">            <span class="keywordflow">if</span> (frame.empty())</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line"></div><div class="line">            <span class="comment">// CanvasCV change#5 - clean &amp; set canvas limits</span></div><div class="line">            canvas.<a class="code" href="classcanvascv_1_1Canvas.html#a8aa6686036b8a1a006718ae62f44b6c2">clearShapes</a>();</div><div class="line">            canvas.<a class="code" href="classcanvascv_1_1Canvas.html#ab9ffc28f7a21e1375da18cc4f03343ae">setSize</a>(frame.size());</div><div class="line"></div><div class="line">            detectAndDraw(hog, frame, canvas);</div><div class="line"></div><div class="line">            <span class="comment">// CanvasCV change#6 - draw shapes &amp; widgets</span></div><div class="line">            canvas.<a class="code" href="classcanvascv_1_1Canvas.html#a018c66e277de7904b8146ea3f3feebdd">redrawOn</a>(frame, out);</div><div class="line">            canvas.<a class="code" href="classcanvascv_1_1Canvas.html#acaf9494a5668046dd0a8908aa97a7a43">imshow</a>(out);</div><div class="line"></div><div class="line">            <span class="comment">// CanvasCV change#7 - get keyboard events from the canvas</span></div><div class="line">            <span class="keywordtype">int</span> c = canvas.<a class="code" href="classcanvascv_1_1Canvas.html#a59397db05f5d9e45264f626f6a2ae528">waitKeyEx</a>( vc.isOpened() ? 30 : 0 ) &amp; 255;</div><div class="line">            <span class="keywordflow">if</span> ( c == <span class="charliteral">&#39;q&#39;</span> || c == <span class="charliteral">&#39;Q&#39;</span> || c == 27)</div><div class="line">                <span class="keywordflow">break</span>;</div><div class="line">        }</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --><p> Notes for the <code>//CanvasCV change#...</code> comments above:</p><ul>
<li>Here the canvas is cleared at each frame. There are ways to optimize this, but first you'll need to see if this affects your performance at all.</li>
<li>As a general rule, if the image size changes, then use <a class="el" href="classcanvascv_1_1Canvas.html#ab9ffc28f7a21e1375da18cc4f03343ae" title="set the Canvas size to match the cv::Mat we&#39;ll use in redrawOn; ">canvascv::Canvas::setSize()</a> to adapt to the new size.</li>
<li>When using the CanvasCV, you create shapes and widgets on the <a class="el" href="classcanvascv_1_1Canvas.html" title="The Canvas class is the entry point into CanvasCV. ">canvascv::Canvas</a> and not on the <em>Mat</em>.</li>
<li><a class="el" href="classcanvascv_1_1Canvas.html#a59397db05f5d9e45264f626f6a2ae528" title="waitKeyEx ">canvascv::Canvas::waitKeyEx()</a> knows to update it's internal shapes and widgets even if you pass 0 as a blocking delay indicator.</li>
<li><em>CCV_STR</em> lets you create a string as you would write into a stream.</li>
<li>When executed with &ndash;video="Path to opencv-3.2.0/samples/data/vtest.avi", you can get <div class="image">
<img src="tut_shapes_code.jpg" alt="tut_shapes_code.jpg"/>
</div>
 <br />
</li>
</ul>
<p><b>That's all for this tutorial</b> </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.11
</small></address>
</body>
</html>
